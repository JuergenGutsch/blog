<!DOCTYPE html>
<html lang="en-us">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<meta content="en-us" http-equiv="Content-Language" />
		<meta content="text/html; charset=utf-8" http-equiv="Content-Type" />
		<link href="/rss.xml" type="application/rss+xml" rel="alternate" title="Blog Feed" />
		<link href="/atom.xml" type="application/atom+xml" rel="alternate" title="Blog Feed" />
		<title>View Components in ASP.NET 5</title>
		<link href='https://fonts.googleapis.com/css?family=Open+Sans:400,300' rel='stylesheet' type='text/css'>
		<!--<link href="/css/prism.css" rel="stylesheet" type="text/css" />-->
		<link href="/css/style.css" rel="stylesheet" type="text/css" />
		<link rel="shortcut icon" href="/img/favicon.ico" />
		
		<meta property="og:title" content="View Components in ASP.NET 5" />
		<meta property="og:site_name" content="ASP.NET Hacker">
		<meta property="og:url" content="http://asp.net-hacker.rocks/2015/11/23/viewcomponents-aspnet5.html" />
		<meta property="og:description" content="One of the nicest new features in ASP.NET 5 are the ViewComponents. These are a kind of mini MVC inside the MVC application.." />
		<meta property="fb:app_id" content="126274111070499" />
		<meta property="og:type" content="article" />
		<meta property="og:locale" content="en_US" />		
		<meta property="article:author" content="https://www.facebook.com/juergen.gutsch" />
		<meta property="article:publisher" content="https://www.facebook.com/juergen.gutsch" />

		<meta name="twitter:card" content="summary" />
		<meta name="twitter:site" content="@sharpcms" />
		<meta name="twitter:title" content="View Components in ASP.NET 5" />
		<meta name="twitter:description" content="One of the nicest new features in ASP.NET 5 are the ViewComponents. These are a kind of mini MVC inside the MVC application.." />
		<meta name="twitter:image" content="http://asp.net-hacker.rocks/img/cardlogo-dark.png" />
	</head>
	<body>
		<div id="container">
			<div id="header">
				<a href="/" id="home" title="Home" alt="Home"><img src="/img/logo-dark.png" alt="ASP.NET Hacker" /></a>
				<!--<div class="section">
					<ul>
						<li><a href="/about.html">about</a></li>
						<li><a href="/rss.xml"><img src="/img/25.png" /> feed</a></li>
					</ul>
				</div>-->
			</div>
			<div id="content">
				<article>
	<header>
		<h1> View Components in ASP.NET 5 </h1>
		<p><span class="byline-name">Jürgen Gutsch</span> - <span class="dateline">23 November, 2015</span>
			
		</p>
	</header>
	
	<p>One of the nicest new features in ASP.NET 5 are the ViewComponents. These are a kind of mini MVC inside the MVC application which can be used like partial Views. They are like partial Views with an own controller, almost comparable with user controls in ASP.NET Webforms. Use cases are continually reused components of a web site or blogs which are not part of the main content. That means all things that must not be passed with the current controller action. Let's use a Blog as an example, which has some more elements like menus, tag lists, link lists, archive overviews, etc. The data of these elements can be passed via the current actions to the view, but this needs to be done in every single action. </p>
<p>It would be nice if the controller actions only have to do one single task: fetching and passing blog posts to the view. All other things should be done on other locations, to not mess up the controller actions.</p>
<p>That's where The ViewComponents entering the stage.</p>
<p>Let me show you how ViewCompnents look like:</p>
<p>First we need to create a simple class which derives from ViewComponent and which needs to have &quot;ViewCompoennt&quot; as a sufix. E. g. &quot;Top20TagsViewComponent&quot;:	</p>
<pre><code>public class Top20TagsViewComponent : ViewComponent 
{ 
    private readonly ITagService _tagService; 

    public RecommendedProductsViewComponent(ITagService tagService) 
    { 
        _tagService = tagService; 
    } 

    public IViewComponentResult Invoke() 
    { 
         var tags = _tagService.LoadTop20Tags(); 
         var models = tags.Select( 
            new TagViewModel 
            { 
                Id = tag.Id, 
                Name = tag.Name 
            }); 
        return View(models); 
    } 
}
</code></pre>

<p>Die Methode Invoke entspricht der Action in einem regulären Controller, an deren Ende eine View erzeugt und zurückgegeben wird. Der TagService der hier genutzt wird kann per IoC in die ViewComponent hineingegeben werden. Da IoC wirklich überall zur Verfügung steht, kann auf jede Quelle zugegriffen werden, auf die eine regulärer Controller zugreift.</p>
<p>Die View ist eine ganz normale Razor View:</p>
<p>@model IEnumerable&lt;DotNetFn.ViewComponents.TagViewModel&gt;</p>
<pre><code>@if (Model.Any()) 
{ 
    &lt;ul&gt; 
        @foreach (var tag in Tags) 
        { 
            &lt;li&gt; 
                [@tag.Id] @tag.Name 
            &lt;/li&gt; 
        } 
    &lt;/ul&gt; 
}
</code></pre>

<p>Einzig der Ort an dem diese View abgelegt werden muss ist ein wenig speziell. Die Views werden unter Shared in einem Ordner Components abgelegt. Dort wiederum in einem Unterordner, der dem Namen der ViewComponent ohne dessen Präfix entspricht. Unsere ViewComponent View liegt also unter /Shared/Components/Top20Tags/Default.aspx</p>
<p>Der Standardname ist Default.aspx. Es kann aber auch jeder beliebige andere Name verwendet werden, wenn dieser in der Methode Invoke angegeben wird: </p>
<pre><code>return View(&quot;TheNicerName&quot;, models);
</code></pre>

<p>Auf die Art könnte man auch innerhalb der ViewComponent das Template wechseln, wenn es erforderlich sein sollte.</p>
<p>Die oben beschriebene Componente wird dann ganz einfach, fast ähnlich wie eine PartialView eingebunden:</p>
<pre><code>@Component.Invoke(&quot;ToTags&quot;);
</code></pre>

<p>Argumente übergeben</p>
<p>Interessant werden ViewComponents auch, wenn man Argumente übergibt. Angenommen wir möchten die Zahl der Tags anpassen, je nachdem, wo wir die Liste einsetzen wollen.</p>
<p>Wir erweitern die Methode Invoke einfach um ein Argument:</p>
<pre><code>public IViewComponentResult Invoke(int count)     
{ 
    var tags = _tagService.LoadTopTags().Take(count);     
    var models = tags.Select(tag =&gt; 
        new TagViewModel 
        { 
            Id = tag.Id, 
            Name = tag.Name 
        }); 
     return View(models); 
} 
</code></pre>

<p>Und rufen die Methode Invoke auch einfach mit diesem zusätzlichen Argument auf:</p>
<pre><code>@Component.Invoke(&quot;ToTags&quot;, 10);
</code></pre>

<p>Asynchrone ViewComponents</p>
<p>Um Asynchrone Views besser zu unterstützen, kann statt der synchronen Methode Invoke auch eine asynchrone Methode geschrieben werden:</p>
<pre><code>public async Task&lt;IViewComponentResult&gt; InvokeAsync(int count)     
{ 
    var tags = await _tagService.LoadTopTags();     
    var models = tags.Select(=&gt; 
        new TagViewModel 
        { 
            Id = tag.Id, 
            Name = tag.Name 
        }).Take(count); 
     return View(models); 
} 
</code></pre>

<p>Bei der Nutzung muss dann await genutzt werden:</p>
<pre><code>@await Component.InvokeAsync(&quot;ToTags&quot;, 10);
</code></pre>


		
	<footer>
		<div>
			<p>
				<img src="/img/guj.png" alt="Jürgen Gutsch" />
				<strong>Jürgen Gutsch</strong><br>
				<a href="https://twitter.com/sharpcms/" target="_blank"><strong>@sharpcms</strong></a><br>
				<span>.NET junkie, addicted to web and software development, clean coder, MVP ASP.​NET/IIS</span>
			</p>
		</div>
		<div id="page-navigation clear"> 
			<div class="left">  </div> 
			<div class="right">  </div> 
			<div class="clear">&nbsp;</div>
		</div> 
				
		
		<div id="disqus_thread"></div>
		<script>
		/**
		* RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
		* LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables
		*/
		
		var disqus_config = function () {
			this.page.url = location.href; // Replace PAGE_URL with your page's canonical URL variable
			this.page.identifier = location.pathname; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
		};
		
		(function() { // DON'T EDIT BELOW THIS LINE
		var d = document, s = d.createElement('script');
		
		s.src = '//aspnethacker.disqus.com/embed.js';
		
		s.setAttribute('data-timestamp', +new Date());
		(d.head || d.body).appendChild(s);
		})();
		</script>
		<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
		
	</footer>
</article>
			</div>
			<div id="footer">
				<div class="left">
					Hallo Welt
				</div>
				<div class="right">
					Hallo Welt
				</div>				
			</div>
		</div>
		<!--<script src="/js/prism.js"></script>-->
		<script>
			(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
			(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
			m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
			})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
			
			ga('create', 'UA-390207-7', 'auto');
			ga('send', 'pageview');
			
		</script>
	</body>
</html>