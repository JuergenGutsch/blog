<!DOCTYPE html>
<html lang="en-us">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<meta content="en-us" http-equiv="Content-Language" />
		<meta content="text/html; charset=utf-8" http-equiv="Content-Type" />
		<link href="/rss.xml" type="application/rss+xml" rel="alternate" title="Blog Feed" />
		<link href="/atom.xml" type="application/atom+xml" rel="alternate" title="Blog Feed" />
		<title>View Components in ASP.NET 5</title>
		<link href='https://fonts.googleapis.com/css?family=Open+Sans:400,300' rel='stylesheet' type='text/css'>
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">
		<!--<link href="/css/prism.css" rel="stylesheet" type="text/css" />-->
		<link href="/css/style.css" rel="stylesheet" type="text/css" />
		<link href="/css/jquery.cookiebar.css" rel="stylesheet" type="text/css"/>
		<link rel="shortcut icon" href="/img/favicon.ico" />
		
		<meta property="og:title" content="View Components in ASP.NET 5" />
		<meta property="og:site_name" content="ASP.NET Hacker">
		<meta property="og:url" content="http://asp.net-hacker.rocks/2015/11/23/viewcomponents-aspnet5.html" />
		<meta property="og:description" content="One of the nicest new features in ASP.NET 5 are the ViewComponents. These are a kind of mini MVC inside the MVC application.." />
		<meta property="fb:app_id" content="126274111070499" />
		<meta property="og:type" content="article" />
		<meta property="og:locale" content="en_US" />		
		<meta property="article:author" content="https://www.facebook.com/juergen.gutsch" />
		<meta property="article:publisher" content="https://www.facebook.com/juergen.gutsch" />

		<meta name="twitter:card" content="summary" />
		<meta name="twitter:site" content="@sharpcms" />
		<meta name="twitter:title" content="View Components in ASP.NET 5" />
		<meta name="twitter:description" content="One of the nicest new features in ASP.NET 5 are the ViewComponents. These are a kind of mini MVC inside the MVC application.." />
		<meta name="twitter:image" content="http://asp.net-hacker.rocks/img/cardlogo-dark.png" />
	</head>
	<body>
		<div id="container">
			<div id="header">
				<a href="/" id="home" title="Home" alt="Home"><img src="/img/logo-dark.png" alt="ASP.NET Hacker" /></a>
				<div class="section">
					<ul>
						<li><a href="/about.html">about</a></li>
						<li><a href="http://feeds.feedburner.com/jgutsch"><span class="fa fa-rss">&nbsp;</span> feed</a></li>
					</ul>
				</div>
			</div>
			<div id="content">
				<article>
	<header>
		<h1> View Components in ASP.NET 5 </h1>
		<p class="postdate">Jürgen Gutsch - 23 November, 2015</p>
		<ul class="postdate">
		
			<li><a href="/tag/ASP.NET 5/index.html">ASP.NET 5</a></li>
		
			<li><a href="/tag/MVC 6/index.html">MVC 6</a></li>
		
			<li><a href="/tag/View Components/index.html">View Components</a></li>
		
		</ul>
	</header>
	
	<p>One of the nicest new features in ASP.NET 5 is the ViewComponent. This is a kind of a 'mini MVC' inside the MVC application which can be used like partial Views. ViewComponents are like partial Views with an own controller, almost comparable with a UserControl in ASP.NET WebForms. </p>
<p>Use cases are multiple reused components of a web application. That means all things that must not be managed by the current controller action. Let's use a Blog as an example, which has some more elements like menus, tag lists, link lists, archive overviews, etc. The data of these elements can be passed via the current actions to the view, but this needs to be done in every single action and produces a lot of duplicate code.</p>
<p>It would be nice if the controller actions only have to do one single task: fetching and passing blog posts to the view. All the other things should be done on other locations, to not mess up the controller actions.</p>
<p>That's where the ViewComponents entering the stage.</p>
<h2>Let me show you how ViewCompnents look like</h2>
<p>First we need to create a simple class which derives from ViewComponent and which needs to have &quot;ViewCompoennt&quot; as a sufix. E. g. &quot;Top20TagsViewComponent&quot;:	</p>
<pre><code>public class Top20TagsViewComponent : ViewComponent 
{ 
    private readonly ITagService _tagService; 

    public Top20TagsViewComponent(ITagService tagService) 
    { 
        _tagService = tagService; 
    } 

    public IViewComponentResult Invoke() 
    { 
         var tags = _tagService.LoadTop20Tags(); 
         var models = tags.Select( 
            new TagViewModel 
            { 
                Id = tag.Id, 
                Name = tag.Name 
            }); 
        return View(models); 
    } 
}
</code></pre>

<p>The method Invoke almost looks like a Action in a usual Controller, which creates and returns a View. The used TagService is injected with the default IoC. Because is available everywhere in ASP.NET 5, you can access everything what accessible with a usual Controller.</p>
<p>The View is pretty common:</p>
<pre><code>@model IEnumerable&lt;DotNetFn.ViewComponents.TagViewModel&gt;

@if (Model.Any()) 
{ 
    &lt;ul&gt; 
        @foreach (var tag in Tags) 
        { 
            &lt;li&gt; 
                [@tag.Id] @tag.Name 
            &lt;/li&gt; 
        } 
    &lt;/ul&gt; 
}
</code></pre>

<p>Only the location where the View needs to be saved is a bit special. You need to save the default View with the name <code>Default.cshtml</code> in a folder, which is named like the ViewComponent without the suffix inside <code>/Views/Shared/Components/</code> Our ViewComponent is stored in <code>/Shared/Components/Top20Tags/Default.cshtml</code></p>
<p>The default name is Default.cshtml, but you can use any other name, if you pass that name to the View: </p>
<pre><code>return View(&quot;TheNicerName&quot;, models);
</code></pre>

<p>With this you are able to switch the Templates inside the ViewComponent, if it is needed.</p>
<p>The described Component will be used almost as a partial View:</p>
<pre><code>@Component.Invoke(&quot;TopTags&quot;);
</code></pre>

<h2>Passing arguments</h2>
<p>A very interesting thing is to pass arguments to a ViewComponent. Maybe you want to change the number of Tags to display, depending on where we want to use this Component.</p>
<p>We only need to extend the Invoke method with one ore more arguments:</p>
<pre><code>public IViewComponentResult Invoke(int count)     
{ 
    var tags = _tagService.LoadTopTags().Take(count);     
    var models = tags.Select(tag =&gt; 
        new TagViewModel 
        { 
            Id = tag.Id, 
            Name = tag.Name 
        }); 
     return View(models); 
} 
</code></pre>

<p>Now we able to call the ViewComponent with that additional argument:</p>
<pre><code>@Component.Invoke(&quot;TopTags&quot;, 10);
</code></pre>

<h2>Asynchronous ViewComponents</h2>
<p>To support asynchronous Views, we can also use a asynchronous Invoke method instead:</p>
<pre><code>public async Task&lt;IViewComponentResult&gt; InvokeAsync(int count)     
{ 
    var tags = await _tagService.LoadTopTags();     
    var models = tags.Select(=&gt; 
        new TagViewModel 
        { 
            Id = tag.Id, 
            Name = tag.Name 
        }).Take(count); 
     return View(models); 
} 
</code></pre>

<p>We only need to use await in the View to use this InvokeAsync:</p>
<pre><code>@await Component.InvokeAsync(&quot;TopTags&quot;, 10);
</code></pre>


		
	<footer>
		<div>
			<p>
				<img src="/img/guj.png" alt="Jürgen Gutsch" />
				<strong>Jürgen Gutsch</strong><br>
				<a href="https://twitter.com/sharpcms/" target="_blank"><strong>@sharpcms</strong></a><br>
				<span>.NET junkie, addicted to web and software development, clean coder, MVP for Visual Studio and Development Technologies</span>
			</p>
		</div>
		<div id="page-navigation clear"> 
			<div class="left">  </div> 
			<div class="right">  </div> 
			<div class="clear">&nbsp;</div>
		</div> 
				
		
		<div id="disqus_thread"></div>
		<script>
		/**
		* RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
		* LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables
		*/
		
		var disqus_config = function () {
			this.page.url = location.href; // Replace PAGE_URL with your page's canonical URL variable
			this.page.identifier = location.pathname; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
		};
		
		(function() { // DON'T EDIT BELOW THIS LINE
		var d = document, s = d.createElement('script');
		
		s.src = '//aspnethacker.disqus.com/embed.js';
		
		s.setAttribute('data-timestamp', +new Date());
		(d.head || d.body).appendChild(s);
		})();
		</script>
		<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
		
	</footer>
</article>
			</div>
			<div id="footer">
				<div class="left">
					<p>Friends blogs</p>
					<ul>
						<li><a target="_blank" href="http://www.aspnetzone.de/blogs/stefanfalz/">Stefan Falz</a></li>
						<li><a target="_blank" href="http://blogs.dotnetgerman.com/">DotNetGerman Bloggers</a></li>
						<li><a target="_blank" href="https://www.norberteder.com/">Norbert Eder</a></li>
						<li><a target="_blank" href="http://blog.thomasbandt.de">Thomas goes .NET</a></li>
						<li><a target="_blank" href="http://blog.alexonasp.net/">Alexander Zeitler</a></li>
						<li><a target="_blank" href="http://www.karsan.de/">Karsten Samaschke</a></li>
						<li><a target="_blank" href="http://weblogs.asp.net/scottgu/default.aspx">ScottGu's Blog</a></li>
						<li><a target="_blank" href="http://blog.codeinside.eu/">Robert Mühsig & Oliver Guhr</a></li>
						<li><a target="_blank" href="http://blog.ppedv.de/author/hannesp.aspx">Hannes Preishuber</a></li>
						<li><a target="_blank" href="http://www.hanselman.com/blog/">Scott Hanselman</a></li>
						<li><a target="_blank" href="http://weblog.west-wind.com/">Rick Strahl's Web Log</a></li>
						<li><a target="_blank" href="http://odetocode.com/blogs/all">K. Scott Allen</a></li>
						<li><a target="_blank" href="http://davidfowl.com/">David Fowler</a></li>
					</ul>
				</div>
				<div class="right">
					<p>My favorite Books</p>
					<ul>
						<li><a target="_blank" href="http://www.amazon.de/gp/product/3955619869/ref=as_li_tl?ie=UTF8&amp;camp=1638&amp;creative=6742&amp;creativeASIN=3955619869&amp;linkCode=as2&amp;tag=gutschonline-21&amp;linkId=CGQXKRBPO6Q6JKWY">Entwurfsmuster von Kopf bis Fuß (ger)</a></li>
						<li><a target="_blank" href="http://www.amazon.de/gp/product/0321545613/ref=as_li_tl?ie=UTF8&amp;camp=1638&amp;creative=6742&amp;creativeASIN=0321545613&amp;linkCode=as2&amp;tag=gutschonline-21&amp;linkId=MBAMTH7U7RZNQBIM">Framework Design Guidelines</a></li>
						<li><a target="_blank" href="http://www.amazon.de/gp/product/3826655486/ref=as_li_tl?ie=UTF8&amp;camp=1638&amp;creative=6742&amp;creativeASIN=3826655486&amp;linkCode=as2&amp;tag=gutschonline-21&amp;linkId=F7G5QTOC3DAESHR3">Clean Code: A Handbook of Agile Software Craftsmanship </a></li>
						<li><a target="_blank" href="http://www.amazon.de/gp/product/3826690214/ref=as_li_tl?ie=UTF8&amp;camp=1638&amp;creative=6742&amp;creativeASIN=3826690214&amp;linkCode=as2&amp;tag=gutschonline-21&amp;linkId=SVR5IU6AKYZUJ5BG">Effektives Arbeiten mit Legacy Code. Refactoring und Testen bestehender Software (ger)</a></li>
						<li><a target="_blank" href="http://www.amazon.de/gp/product/B00L6K4SQU/ref=as_li_tl?ie=UTF8&amp;camp=1638&amp;creative=6742&amp;creativeASIN=B00L6K4SQU&amp;linkCode=as2&amp;tag=gutschonline-21&amp;linkId=35KMIAWR6SRLG3LX">Why Software Sucks...and What You Can Do about It</a></li>
						<li><a target="_blank" href="http://www.amazon.de/gp/product/3446223096/ref=as_li_tl?ie=UTF8&amp;camp=1638&amp;creative=6742&amp;creativeASIN=3446223096&amp;linkCode=as2&amp;tag=gutschonline-21&amp;linkId=SRL355UJYMSA4XYY">Der Pragmatische Programmierer (ger)</a></li>
						<li><a target="_blank" href="http://www.amazon.de/gp/product/382669712X/ref=as_li_tl?ie=UTF8&amp;camp=1638&amp;creative=6742&amp;creativeASIN=382669712X&amp;linkCode=as2&amp;tag=gutschonline-21&amp;linkId=YV7II2PJAALC4VOW">The Art Of Unit Testing</a></li>
						<li><a target="_blank" href="http://www.amazon.de/gp/product/B00MEYK0SC/ref=as_li_tl?ie=UTF8&amp;camp=1638&amp;creative=6742&amp;creativeASIN=B00MEYK0SC&amp;linkCode=as2&amp;tag=gutschonline-21&amp;linkId=ZBLKLEPAR2RVWZB2">Test Driven Development: By Example</a></li>
		            </ul>
				</div>
				<div class="clear"></div>
			</div>
		</div>
		<!--<script src="/js/prism.js"></script>-->
		<script>
			(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
			(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
			m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
			})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
			
			ga('create', 'UA-390207-7', 'auto');
			ga('send', 'pageview');
			
		</script>
		<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.8/jquery.min.js"></script>		
		<script type="text/javascript" src="/js/jquery.cookiebar.js"></script>		
		<script>
			if($){
				$(document).ready(function(){
					$.cookieBar({
					});
				});
			}
		</script>
	</body>
</html>